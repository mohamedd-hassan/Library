\mysection{Exemple: un bogue dans Angband}
\myindex{Angband}
\label{Angband}

Un ancien jeu rogue-like des années 90
\footnote{\url{https://en.wikipedia.org/wiki/Angband_(video_game)}, \url{http://rephial.org/}}
avait un bogue dans l'esprit de ``Roadside Picnic''\footnote{\url{https://en.wikipedia.org/wiki/Roadside_Picnic}}
par les frères Strugatsky ou ``The Lost Room'', une série TV\footnote{\url{https://en.wikipedia.org/wiki/The_Lost_Room}}:

\begin{framed}
\begin{quotation}
The frog-knows version was abundant of bugs.
The funniest of them led to a cunning technique of cheating the game, that was called "mushroom farming".
If there were more than a certain number (about five hundred) of objects in the labyrinth, the game would break,
and many old things turned into objects thrown to the floor. Accordingly, the player went into the maze,
he made such longitudinal grooves there (with a special spell), and walked along the grooves,
creating mushrooms with another special spell.
When there were a lot of mushrooms, the player put and took, put and took some useful item,
and mushrooms one by one turned into this subject.
After that, the player returned with hundreds of copies of the useful item.
\end{quotation}
\end{framed}
( Misha ``tiphareth'' Verbitsky, \url{http://imperium.lenin.ru/CEBEP/arc/3/lightmusic/light.htm} )

Et d'autres informations provenant de usenet:

\begin{lstlisting}
From: be...@uswest.com (George Bell)
Subject: [Angband] Multiple artifact copies found (bug?)
Date: Fri, 23 Jul 1993 15:55:08 GMT

Up to 2000 ft I found only 4 artifacts, now my house is littered with the
suckers (FYI, most I've gotten from killing nasties, like Dracoliches and the
like).  Something really weird is happening now, as I found multiple
copies of the same artifact!  My half-elf ranger is down at 2400 ft on one
level which is particularly nasty.  There is a graveyard plus monsters
surrounded by permanent rock and 2 or 3 other special monster rooms!  I did
so much slashing with my favorite weapon, Crisdurian, that I filled several
rooms nearly to the brim with treasure (as usual, mostly junk).

Then, when I found a way into the big vault, I noticed some of the treasure
had already been identified (in fact it looked strangely familiar!).  Then I
found *two* Short Swords named Sting (1d6) (+7,+8), and I just ran across a
third copy!  I have seen multiple copies of Gurthang on this level as well.
Is there some limit on the number of items per level which I have exceeded?
This sounds reasonable as all multiple copies I have seen come from this level.

I'm playing PC angband.  Anybody else had this problem?

-George Bell

Help!  I need a Rod of Restore Life Levels, if there is such a thing.  These
Graveyards are nasty (Black Reavers and some speed 2 wraith in particular). 
\end{lstlisting}
( \url{https://groups.google.com/forum/#!original/rec.games.moria/jItmfrdGyL8/8csctQqA7PQJ} )

\begin{lstlisting}
From: Ceri <cm...@andrew.cmu.edu>
Subject: Re: [Angband] Multiple artifact copies found (bug?)
Date: Fri, 23 Jul 1993 23:32:20 -0400

welcome to the mush bug. if there are more than 256 items
on the floor, things start duplicating. learn to harness
this power and you will win shortly  :>

--Rick
\end{lstlisting}
( \href{https://groups.google.com/forum/#!search/angband$202.4$20bug$20multiplying$20items/rec.games.moria/jItmfrdGyL8/FoQeiccewHAJ}{google groups} )

\begin{lstlisting}
From: nwe...@soda.berkeley.edu (Nicholas C. Weaver)
Subject: Re: [Angband] Multiple artifact copies found (bug?)
Date: 24 Jul 1993 18:18:05 GMT

In article <74348474...@unix1.andrew.cmu.edu> Ceri <cm...@andrew.cmu.edu> writes:
>welcome to the mush bug. if there are more than 256 items
>on the floor, things start duplicating. learn to harness
>this power and you will win shortly  :>
>
>--Rick


	QUestion on this.  Is it only the first 256 items which get
duplicated?  What about the origional items?  Etc ETc ETc...

	Oh, for those who like to know about bugs, though, the -n option
(start new character) has the following behavior:

	(this is in version 2.4.Frog.knows on unix)

	If you hit controll-p, you keep your old stats.

	YOu loose all record of artifacts founds and named monsters killed.

	YOu loose all items you are carrying (they get turned into error in
objid()s ).

	You loose your gold.

	You KEEP all the stuff in your house.

	If you kill something, and then quaff a potion of restore life
levels, you are back up to where you were before in EXPERIENCE POINTS!!

	Gaining spells will not work right after this, unless you have a
gain int item (for spellcasters) or gain wis item (for priests/palidans), in
which case after performing the above, then take the item back on and off,
you will be able to learn spells normally again.


	This can be exploited, if you are a REAL H0ZER (like me), into
getting multiple artifacts early on.  Just get to a level where you can
pound wormtongue into the ground, kill him, go up, drop your stuff in your
house, buy a few potions of restore exp and high value spellbooks with your
leftover gold, angband -n yourself back to what you were before, and repeat
the process.   Yes, you CAN kill wormtongue multiple times.  :)

	This also allows the creation of a human rogue with dunedain warrior
starting stats.

	Of course, such practices are evil, vile, and disgusting.  I take no
liability for the results of spreading this information.  Yeah, it's another
bug to go onto the pile.
-- 
Nicholas C. Weaver       perpetual ensign guppy      nwe...@soda.berkeley.edu
 It is a tale, told by an idiot, full of sound and fury, .signifying nothing.
          Since C evolved out of B, and a C+ is close to a B,
        does that mean that C++ is a devolution of the language?
\end{lstlisting}
( \url{https://groups.google.com/forum/#!original/rec.games.moria/jItmfrdGyL8/FoQeiccewHAJ} )

\href{https://groups.google.com/forum/#!search/angband$202.4$20bug$20multiplying$20items/rec.games.moria/jItmfrdGyL8/FoQeiccewHAJ}{Le fil de discussion complet}.

J'ai trouvé la version avec le bogue (2.4 fk)
\footnote{\url{http://rephial.org/release/2.4.fk}, \url{https://yurichev.com/mirrors/angband-2.4.fk.tar}},
et on peut voir clairement comment les tableaux globaux sont déclarés:

\begin{lstlisting}[style=customc]
/* Number of dungeon objects */
#define MAX_DUNGEON_OBJ  423

...

int16 sorted_objects[MAX_DUNGEON_OBJ];

/* Identified objects flags					*/
int8u object_ident[OBJECT_IDENT_SIZE];
int16 t_level[MAX_OBJ_LEVEL+1];
inven_type t_list[MAX_TALLOC];
inven_type inventory[INVEN_ARRAY_SIZE];
\end{lstlisting}

Peut-être que ceci est une raison. La constante \TT{MAX\_DUNGEON\_OBJ} est trop petite.
Peut-être que les auteurs devraient utiliser des listes chaînées ou d'autres structures
de données, qui ont une taille illimitée.
Mais les tableaux sont plus simples à utiliser.

Un autre exemple de débordement de tampon dans un tableau défini globalement: \myref{GlobalArraysOverflowHeisenbug}.

